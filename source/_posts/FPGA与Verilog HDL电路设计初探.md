---
title: FPGA与Verilog HDL电路设计初探
date: 2015-08-23 00:00:00
categories: 技术博文
tags: [FPGA]
---

>**导言：** 这半个月花了一些时间研究FPGA上的嵌入式开发，特别是在图像处理方面的应用，都不敢称得上入门，只能说在门口往里稍微看了看。目前FPGA做图像处理方向的人还不多，这个方向相比其他平台有其优势，相信未来会有越来越多的人来尝试。这里将自己这段时间所学到的一些知识点整理出来，一方面做自己梳理思路之用，另一方面希望对今后从事这个方向的初学者有些帮助。

<!-- more -->

##Verilog HDL硬件设计

Verilog是一种硬件描述语言。从名字看就知道，它不是程序设计语言，而是用来描述电路结构的。通俗的讲就是算法的实现电路已经在你脑子里了，你需要用语言把这些电路部件和相互连接关系给表述出来。你可以一个门一个门的表示（门级表示），也可以抽象性高一些地用运算符和数据赋值等形式来表示（RTL级），甚至可以再抽象一些地使用高级语言里的一些特性来表示(case，if，for等等)。

###综合

Verilog中有一个很重要的概念：**综合**。它指的是将硬件描述语言翻译成门级网表和相互连线的过程。综合之后的网表再经过实现，与实际的FPGA硬件建立映射关系，才能产生实际的电路。综合这个过程有点像编译器将C语言编译成汇编语言的过程。有所不同的是，你写出的C语言只要语法正确，都可以翻译成汇编语言，但写出的Verilog却不一定都可以被综合成门级网表。这里就有了另一个衍生的概念：可综合。

Verilog中的语法中只有一个子集的语法是可以被用来综合的。为什么这么设计呢？因为Verilog集合了硬件描述和硬件仿真两大功能。

- **硬件描述**  硬件描述是Verilog最主要的功能。这部分需要被综合转换成实际电路的，所以只有某些可以被转换成电路的语法才可以使用。
-  **硬件仿真**是为硬件描述服务的，用于在各个层次验证电路是否正确。刚才说综合就像C语言中的编译，那Verilog中的仿真就可以类比C语言开发中的测试。仿真是用程序模拟真实信号的输入，并不需要转换成实际电路，因此任何Verilog允许的语法都可以用来仿真。

提早在脑子里有“**可综合**”的概念至关重要，意识到“可综合”，你也就差不多有电路的意识了。我学Verilog语法看的是夏宇闻翻译的《***Verilog HDL数字设计与综合***》，手边也有他写的《***Verilog数字系统设计教程***》草草翻过。这两本书在国内推荐度很高，我也相信其专业性，不足就是：上来直接讲了一堆Verilog的语法，却连哪些是用来仿真的语法，哪些是用来设计电路的语法都没有说明，这样看下去基本很难对数字系统设计有领悟。Verilog本来就和C的语法很像，只看操作符、条件控制等语法，直接联想到C语言，“这些不都和C语言一样吗？我都会啊！”，那就完了。

我这里推荐云创工作室写的《***Verilog HDL硬件描述语言程序设计与实践教程***》(名字真长...)，开始就将这些概念概述的很清楚，将一些基础语法的时候还会配有综合后的RTL结构图，慢慢的就会有意识：这些加号啊、if语句啊，都不是简单的数学运算和分支语句，而是自己设计的电路中的一个个部件。

###仿真
据说大型的硬件系统设计，仿真代码是实现代码的好几倍之多，我猜测可能像大型软件项目一样，测试代码也比逻辑代码多很多吧。不过似乎硬件仿真的确比软件测试麻烦，需要进行功能仿真、时序仿真和片上验证。功能仿真可以验证电路功能是否正确，时序仿真是在综合之后引入电路的延迟的仿真，片上验证则是直接在电路板上进行验证结果。

对于在FPGA开发图像处理算法，我觉得使用ModelSim进行仿真难度挺大的，而且可能将图像通过IO传出来看来调试，速度会更快一些。另外，对图像甚至视频流进行功能仿真和时序仿真怎么来实现，我现在还不知道。


